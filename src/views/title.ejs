<!-- タイトル画面 / Title Screen -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>タイトル画面</title>
  <link rel="stylesheet" href="/styles/title.css">
  <link rel="stylesheet" href="/styles/common.css">
</head>
<body>
  <div class="main-container">
    <script>
      // 初回アクセス時のみ音確認ダイアログを表示
      if (!sessionStorage.getItem('soundConfirmed')) {
        window.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() {
            const ok = confirm('このゲームではおんがくがなります。おとをだしてもいい？\nBGM/SEのON,OFFは後から設定画面でも変更できます。');
            sessionStorage.setItem('soundConfirmed', '1');
            localStorage.setItem('bgmOn', ok ? '1' : '0');
            localStorage.setItem('seOn', ok ? '1' : '0');
          }, 300);
        });
      }
    </script>
    <!-- BGM/SEの再生用audioタグ（サイト全体で利用） -->
    <audio id="bgm" src="/assets/sound/bgm/main.mp3" loop></audio>
    <audio id="se" src="/assets/sound/se/main.mp3"></audio>
    <script>
      // BGM/SEのON/OFF制御
      function playBGM() {
        if (localStorage.getItem('bgmOn') === '1') {
          document.getElementById('bgm').play();
        }
      }
      function stopBGM() {
        document.getElementById('bgm').pause();
        document.getElementById('bgm').currentTime = 0;
      }
      function playSE() {
        if (localStorage.getItem('seOn') === '1') {
          const se = document.getElementById('se');
          se.currentTime = 0;
          se.play();
        }
      }
      // ページ表示時にBGM自動再生（ONの場合のみ）
      window.addEventListener('DOMContentLoaded', playBGM);
    </script>
    <header>
      <a href="/settings" id="settings-icon" title="設定" style="position:absolute;left:16px;top:16px;z-index:2;">
        <img src="/assets/gear.png" alt="設定" style="width:32px;height:32px;">
      </a>
      <div id="sound-toggle" style="position:absolute;right:16px;top:16px;z-index:2;display:flex;gap:8px;">
        <button type="button" id="bgm-toggle">BGM: <span id="bgm-status"></span></button>
        <button type="button" id="se-toggle">SE: <span id="se-status"></span></button>
      </div>
    </header>
    <main style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;">
      <h1 style="text-align:center;">Aira PJ</h1>
      <form action="/character" method="get" id="start-form" style="margin:16px 0;">
        <button type="submit" id="start-btn">ゲームをはじめる</button>
      </form>
      <div style="margin-bottom:16px;">
        <a href="/history" id="favorites-menu">おきにいり</a>
      </div>
      <div id="overlay" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);transition:opacity 0.5s;"></div>
      <script>
        // スタートボタン押下時にSEを鳴らし、再生終了後にキャラクター選択ページへ遷移＋連打防止＆フェードアウト
        document.getElementById('start-form').addEventListener('submit', function(e) {
          e.preventDefault();
          const overlay = document.getElementById('overlay');
          overlay.style.display = 'block';
          overlay.style.opacity = '1';
          const se = document.getElementById('se');
          se.currentTime = 0;
          se.play();
          se.onended = function() {
            overlay.style.opacity = '0';
            setTimeout(function() {
              window.location.href = '/character';
            }, 500); // フェードアウト後に遷移
          };
        });
        // おきにいりクリック時にもSEを鳴らす（例）
        document.getElementById('favorites-menu').addEventListener('click', function(e) {
          playSE();
        });
        // BGM/SE ON/OFFボタン制御
        function updateSoundStatus() {
          document.getElementById('bgm-status').textContent = localStorage.getItem('bgmOn') === '1' ? 'ON' : 'OFF';
          document.getElementById('se-status').textContent = localStorage.getItem('seOn') === '1' ? 'ON' : 'OFF';
        }
        document.getElementById('bgm-toggle').onclick = function() {
          localStorage.setItem('bgmOn', localStorage.getItem('bgmOn') === '1' ? '0' : '1');
          updateSoundStatus();
          if(localStorage.getItem('bgmOn') === '1') playBGM(); else stopBGM();
        };
        document.getElementById('se-toggle').onclick = function() {
          localStorage.setItem('seOn', localStorage.getItem('seOn') === '1' ? '0' : '1');
          updateSoundStatus();
        };
        updateSoundStatus();
      </script>
    </main>
    <footer>
      <a href="/terms" id="terms-link" style="font-size:small;position:absolute;left:16px;bottom:16px;">規約・クレジット</a>
    </footer>
  </div>
</body>
</html>
