<!-- 設定画面 / Settings Screen -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>設定</title>
  <link rel="stylesheet" href="/styles/title.css">
  <link rel="stylesheet" href="/styles/common.css">
</head>
<body>
  <div class="main-content">
  <h1>設定</h1>
  <!-- 設定UIをここに実装 -->
  <nav>
    <a href="/title">タイトルへ戻る</a>
  </nav>
  <!-- 管理者モード判定（サーバ側でadminフラグを渡す想定） -->
    <h2>画像アセットアップロード</h2>
    <form id="uploadForm" enctype="multipart/form-data">
      <label>アップロード種別:
        <select name="type" id="assetType">
          <option value="character">キャラクター</option>
          <option value="background">背景</option>
          <option value="costume">衣装</option>
        </select>
      </label>
      <br>
      <label>名前: <input type="text" name="name" id="assetName" required></label>
      <br>
      <input type="file" name="asset" id="assetFile" accept="image/png" required>
      <br>
      <button type="submit">アップロード</button>
    </form>
    <div id="uploadResult"></div>
    <script>
      document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const type = document.getElementById('assetType').value;
        const name = document.getElementById('assetName').value;
        const fileInput = document.getElementById('assetFile');
        const file = fileInput.files[0];
        if (!file || file.type !== 'image/png') {
          document.getElementById('uploadResult').innerText = 'PNG画像のみアップロード可能です。';
          return;
        }
        const formData = new FormData();
        formData.append('name', name);
        formData.append('asset', file);
        let url = '';
        if (type === 'character') url = '/character/upload';
        if (type === 'background') url = '/background/upload';
        if (type === 'costume') url = '/costume/upload';
        const res = await fetch(url, { method: 'POST', body: formData });
        const result = await res.json();
        if (result.success) {
          document.getElementById('uploadResult').innerHTML =
            'アップロード成功！<br>ID: ' + (result.character?.id || result.background?.id || result.costume?.id) +
            '<br>画像: <img src="/' + (result.character?.assetPath || result.background?.assetPath || result.costume?.assetPath) + '" width="100">';
        } else {
          document.getElementById('uploadResult').innerText = result.error || 'アップロード失敗';
        }
      });
    </script>
  </div>
</body>
</html>
