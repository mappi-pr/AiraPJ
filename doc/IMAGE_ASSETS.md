# 画像アセット作成ガイド

このドキュメントは、AiraPJ（着せ替えゲームエンジン）で使用する画像アセットを作成する方のためのガイドです。

## 目次

- [概要](#概要)
- [アセットの種類と用途](#アセットの種類と用途)
- [技術仕様](#技術仕様)
- [レイヤー構造と重ね順](#レイヤー構造と重ね順)
- [作成ガイドライン](#作成ガイドライン)
- [アップロード手順](#アップロード手順)
- [トラブルシューティング](#トラブルシューティング)

---

## 概要

AiraPJ は、キャラクターの顔・髪・衣装・背景を組み合わせて、オリジナルのキャラクターを作成できる着せ替えゲームエンジンです。各パーツは PNG 画像として用意され、透明度を活用して重ね合わせることで、自然な合成を実現します。

### 基本コンセプト

- **レイヤー構造**: 複数の透過 PNG を重ねることでキャラクターを構成
- **固定サイズ**: すべてのパーツは同じキャンバスサイズ（240×320px）で作成
- **透過必須**: 背景以外のすべてのパーツは透過 PNG が必要

---

## アセットの種類と用途

### 1. 背景（Background）

**用途**: キャラクターの後ろに表示される背景画像

**特徴**:
- 最も奥のレイヤー（z-index: 0）
- 透過不要（`objectFit: 'cover'` で表示）
- キャンバス全体を覆うように配置

**例**: 部屋、屋外、風景、パターン背景など

**保存先**: `api/uploads/bg/`

---

### 2. 後髪（Back Hair）

**用途**: キャラクターの頭部の後ろ側の髪

**特徴**:
- 背景の次のレイヤー（z-index: 1）
- **透過必須**（PNG アルファチャンネル）
- 衣装や顔の後ろに配置される
- 長い髪やツインテールの後ろ部分など

**例**: ロングヘアの後ろ側、ポニーテールの後ろ部分、ツインテールの後ろなど

**保存先**: `api/uploads/backHair/`

---

### 3. 衣装（Costume）

**用途**: キャラクターの服装

**特徴**:
- 後髪と顔の間のレイヤー（z-index: 2）
- **透過必須**（PNG アルファチャンネル）
- 体や首、肩などを含む
- 顔の一部（首など）と重なることがある

**例**: Tシャツ、ドレス、制服、コート、アクセサリーなど

**保存先**: `api/uploads/csm/`

---

### 4. 顔（Face）

**用途**: キャラクターの顔（目、鼻、口など）

**特徴**:
- 衣装と前髪の間のレイヤー（z-index: 3）
- **透過必須**（PNG アルファチャンネル）
- 表情のバリエーションを作成可能
- 後髪・衣装の上、前髪の下に配置

**例**: 笑顔、悲しい顔、驚いた顔、ウィンクなど

**保存先**: `api/uploads/face/`

---

### 5. 前髪（Front Hair）

**用途**: キャラクターの頭部の前側の髪

**特徴**:
- 最も手前のレイヤー（z-index: 4）
- **透過必須**（PNG アルファチャンネル）
- すべてのパーツの上に表示される
- 顔の一部を覆うことができる

**例**: 前髪、ショートヘアの前部分、サイドの髪など

**保存先**: `api/uploads/frontHair/`

---

### 6. ナビゲーションボタン（Navigation Buttons）

**用途**: カスタムのナビゲーションボタン画像（オプション）

**特徴**:
- 「前へ」（prev）と「次へ」（next）の2種類
- **透過推奨**（PNG アルファチャンネル）
- 設定しない場合はテキストボタンが表示される

**保存先**: `api/uploads/nav/`

---

## 技術仕様

### 画像サイズ

**すべてのパーツで固定**:
- **幅**: 240px
- **高さ**: 320px
- **アスペクト比**: 3:4

> ⚠️ **重要**: サイズが異なると、パーツが正しく配置されません。必ず 240×320px で作成してください。

### ファイル形式

- **形式**: PNG（Portable Network Graphics）のみ
- **ビット深度**: 24ビット RGB + 8ビットアルファ（RGBA）推奨
- **圧縮**: PNG 圧縮（可逆圧縮）

> ⚠️ **注意**: JPEG や GIF など他の形式はサポートされていません。

### 透過（アルファチャンネル）

**背景以外のすべてのパーツで必須**:
- パーツ以外の部分は完全に透明（alpha = 0）にする
- 半透明（0 < alpha < 255）も使用可能
- エッジは滑らかに（アンチエイリアス処理）

**背景**:
- 透過は不要（あっても問題なし）
- キャンバス全体を覆うように作成

---

## レイヤー構造と重ね順

アセットは以下の順序で重ねられます（下から上へ）:

```
┌─────────────────────────────────┐
│  5. 前髪 (Front Hair)            │ ← z-index: 4（最前面）
├─────────────────────────────────┤
│  4. 顔 (Face)                    │ ← z-index: 3
├─────────────────────────────────┤
│  3. 衣装 (Costume)               │ ← z-index: 2
├─────────────────────────────────┤
│  2. 後髪 (Back Hair)             │ ← z-index: 1
├─────────────────────────────────┤
│  1. 背景 (Background)            │ ← z-index: 0（最背面）
└─────────────────────────────────┘
```

### 重ね順の考え方

1. **背景**: 最も奥に配置、すべてのパーツの下に表示
2. **後髪**: 長い髪などが背後に配置される
3. **衣装**: 体や服が中間に配置
4. **顔**: 表情が衣装の上に表示
5. **前髪**: 最前面に配置、顔の一部を覆うことができる

### 設計時の注意点

- **後髪と前髪の分割**: 長い髪は「後ろ」と「前」で分けて作成することで、顔や衣装が間に配置される
- **衣装と顔の境界**: 首や肩の部分で自然に重なるように設計
- **透過領域**: 不要な部分は完全に透明にすることで、下のレイヤーが透けて見える

---

## 作成ガイドライン

### 推奨ツール

- **Adobe Photoshop**: プロフェッショナルな画像編集
- **GIMP**: 無料でオープンソースの代替ツール
- **Krita**: デジタルペイントに特化した無料ツール
- **Clip Studio Paint**: イラスト制作に特化
- **Aseprite**: ドット絵やピクセルアート向け

### 作成手順

#### 1. キャンバスの作成

1. 新規ファイルを作成
2. サイズを **240×320px** に設定
3. 解像度は 72 dpi または 96 dpi（Web用）
4. カラーモードは **RGB + アルファ**

#### 2. パーツの描画

1. **ガイドライン**を使用して配置を確認
   - 中央線（120px）
   - 目の高さ（約100-120px）
   - 口の位置（約140-160px）
2. **レイヤー**を活用して作業
   - 線画レイヤー
   - 色塗りレイヤー
   - ハイライトレイヤー
3. **エッジ**を滑らかに
   - アンチエイリアスを有効にする
   - ぼかしを少し追加してエッジを柔らかく

#### 3. 透過領域の設定

1. パーツ以外の領域を **消しゴムツール** で完全に透明にする
2. または **選択範囲** → **反転** → **削除**
3. **透明度を確認**: チェッカーボード背景で確認

#### 4. 他のパーツとの整合性確認

1. **重ね順を確認**:
   - 他のパーツと組み合わせて表示を確認
   - 境界が自然か確認
2. **サイズを確認**:
   - 顔のサイズ、髪の長さが他のパーツと統一されているか
3. **色調を確認**:
   - 他のパーツと色合いが合っているか

#### 5. 書き出し

1. **ファイル形式**: PNG
2. **圧縮**: PNG-24（24ビット RGB + アルファ）
3. **透過**: アルファチャンネルを保持
4. **ファイル名**: 分かりやすい名前（例: `long_hair_blonde.png`, `smile_face.png`）

### デザインのヒント

#### 統一感を持たせる

- **線の太さ**: すべてのパーツで同じ線の太さを使用
- **色調**: 同じカラーパレットを使用
- **スタイル**: 同じ画風（アニメ風、リアル風、ドット絵など）

#### 汎用性を高める

- **ニュートラルな色**: 使いやすい基本色を優先
- **シンプルなデザイン**: 複雑すぎず、組み合わせやすい
- **バリエーション**: 色違い、表情違いなどのバリエーションを用意

#### 透過を活用する

- **グラデーション透過**: 髪の先端などで自然なフェードアウト
- **半透明**: ベールやガラスなどの表現
- **影**: 柔らかい影を透過で表現

---

## アップロード手順

### Web UI からのアップロード

1. **アプリケーションを起動**
   - 開発モード: http://localhost:5173
   - 本番モード: http://localhost:80 (nginx経由)

2. **設定画面に移動**
   - タイトル画面から「設定」リンクをクリック

3. **アセットをアップロード**
   1. 「アセット種別」を選択（顔、前髪、後髪、背景、衣装）
   2. 「名前」を入力（例: 「笑顔」「ロングヘア」）
   3. 「ファイル選択」ボタンをクリックして PNG ファイルを選択
   4. 「アップロード」ボタンをクリック

4. **アップロード結果を確認**
   - 成功メッセージとプレビュー画像が表示される
   - ID が自動的に割り当てられる

5. **アセットリストを確認**
   - 各アセット種別のセクションを展開
   - アップロードされたアセットが一覧表示される
   - 並び替え、削除が可能

### ナビゲーションボタンのアップロード

1. **設定画面の「ナビゲーションボタン画像設定」セクション**
2. 「前へボタン」または「次へボタン」のファイルを選択
3. 「アップロード」ボタンをクリック
4. デフォルトに戻す場合は「リセット」ボタンをクリック

---

## トラブルシューティング

### アップロードできない

**問題**: 「PNG形式の画像のみアップロード可能です」というエラーが表示される

**原因**:
- ファイル形式が PNG 以外（JPEG、GIF など）
- ファイル拡張子が `.png` でない

**解決方法**:
1. 画像編集ツールで PNG 形式で書き出し直す
2. ファイル拡張子が `.png` であることを確認

---

### パーツが正しく表示されない

**問題**: アップロードしたパーツがキャンバスからはみ出る、または小さすぎる

**原因**:
- 画像サイズが 240×320px でない

**解決方法**:
1. 画像編集ツールでキャンバスサイズを 240×320px に変更
2. パーツの位置を調整
3. 再度書き出してアップロード

---

### 透過が効いていない

**問題**: 透明にしたはずの部分が白または黒で表示される

**原因**:
- アルファチャンネルが保存されていない
- PNG-8 で保存している（アルファ非対応）
- 背景レイヤーが残っている

**解決方法**:
1. **画像編集ツールで確認**:
   - 背景レイヤーを削除
   - チェッカーボード背景で透明度を確認
2. **書き出し設定を変更**:
   - PNG-24（24ビット RGB + アルファ）で書き出す
   - 「透過を保持」または「アルファチャンネルを保持」にチェック
3. 再度書き出してアップロード

---

### パーツの重ね順がおかしい

**問題**: 顔が髪の上に表示される、など

**原因**:
- レイヤー構造を誤解している
- パーツの種類を間違えてアップロード

**解決方法**:
1. **レイヤー構造を確認**: [レイヤー構造と重ね順](#レイヤー構造と重ね順)を参照
2. **正しいパーツ種別でアップロード**:
   - 後ろの髪 → 「後髪」
   - 前の髪 → 「前髪」
   - 顔 → 「顔」
   - 衣装 → 「衣装」
   - 背景 → 「背景」
3. 必要に応じてアセットを削除して再アップロード

---

### 他のパーツとの組み合わせがうまくいかない

**問題**: 特定のパーツと組み合わせると不自然に見える

**原因**:
- パーツのサイズや位置が他のパーツと統一されていない
- 色調が合っていない

**解決方法**:
1. **基準パーツを決める**:
   - 既存のパーツを基準にサイズや位置を合わせる
   - グリッドやガイドラインを活用
2. **カラーパレットを統一**:
   - 既存パーツの色をスポイトツールで取得
   - 同じ色調・彩度・明度を使用
3. **テスト**:
   - 複数のパーツと組み合わせて確認
   - 必要に応じて調整

---

### エッジが粗い

**問題**: パーツの輪郭がギザギザに見える

**原因**:
- アンチエイリアスが無効になっている
- 低解像度で作成して拡大している

**解決方法**:
1. **アンチエイリアスを有効化**:
   - ブラシや消しゴムツールでアンチエイリアスをオン
2. **適切な解像度で作成**:
   - 最初から 240×320px で作成
   - または高解像度で作成して縮小
3. **エッジを滑らかにする**:
   - 1-2px のぼかしを適用
   - フェザリングを使用

---

### ファイルサイズが大きすぎる

**問題**: アップロードに時間がかかる、またはサイズ制限エラー

**原因**:
- 不要なメタデータが含まれている
- 圧縮が不十分

**解決方法**:
1. **PNG 圧縮ツールを使用**:
   - [TinyPNG](https://tinypng.com/)（オンライン、⚠️ 機密性の高い画像は避ける）
   - [PNGGauntlet](https://pnggauntlet.com/)（Windows、ローカル処理）
   - [ImageOptim](https://imageoptim.com/)（Mac、ローカル処理）
   
   > ⚠️ **セキュリティ注意**: オンライン圧縮ツールは第三者サーバーに画像をアップロードします。機密性の高いコンテンツや未公開のアセットの場合は、ローカルで動作する圧縮ツールを使用してください。

2. **書き出しオプションを調整**:
   - メタデータを削除
   - 不要なチャンネルを削除
3. **レイヤーを統合**:
   - 書き出し前にレイヤーを結合

---

## まとめ

### チェックリスト

アップロード前に以下を確認してください:

- [ ] **サイズ**: 240×320px
- [ ] **形式**: PNG（.png）
- [ ] **透過**: 背景以外はアルファチャンネルあり
- [ ] **エッジ**: アンチエイリアス処理済み
- [ ] **統一感**: 他のパーツとスタイルが統一されている
- [ ] **ファイル名**: 分かりやすい名前

### さらに学ぶ

- **[開発者ガイド](DEVELOPMENT.md)**: 開発環境の構築方法
- **[CSS アーキテクチャ](CSS.md)**: スタイル管理とデザインガイドライン
- **[ボイス実装ガイド](VOICE_IMPLEMENTATION.md)**: ボイス機能の実装方法
- **[多言語対応](MULTILINGUAL.md)**: 国際化対応の実装方法

---

ご質問やフィードバックがありましたら、GitHub Issues でお知らせください。
